ΕΡΓΑΣΙΑ 3 ΥΣΒΔ

ΔΡΑΚΑΚΗ ΑΙΚΑΤΕΡΙΝΗ 1115201300041
ΛΩΛΟΣ   ΠΑΝΑΓΙΩΤΗΣ 1115201300088
ΑΝΔΡΕΑΣ ΤΖΑΛΑΚΑΣ   1115201300173

Στον παραδοτέο κώδικα έχουν υλοποιηθεί πλήρως όλες οι συναρτήσεις που ζητούνται για να εκτελούν ακριβώς τις απαιτούμενες εργασίες. Στον φάκελο include συμπεριλαμβάνεται ένα επιπλέον
αρχείο που διαθέτει τα πρωτότυπα κάποιων βοηθητικών συναρτήσεων, το funcs.h με το funcs.c να βρίσκεται στον φάκελο src. Τα αρχεία funcs/AM αναλύονται παρακάτω. Η εργασία δοκιμάστηκε
σε περιβάλλοντα linux και Visual Studio με επιτυχία και για τις 3 δοθείσες main, οι οποίες δεν έχουν αλλαχθεί καθόλου.
Πιο αναλυτικά για τις συναρτήσεις που υλοποιήθηκαν.
Το αρχείο funcs.h/.c περιέχει:
	-ορισμένες χρήσιμες δηλώσεις global σταθερών
	-struct am_attr_types_s: που χρησιμοποιείται για την αποθήκευση των 4 απαραίτητων πληροφοριών για τα δεδομένα του B+ δένδρου (τύπος/μέγεθος key, τύπος/μέγεθος data)
	-struct open_file_info/open_scan_info: χρησιμοποιούνται για την αποθήκευση και την ενημέρωση του αντίστοιχου πίνακα πληροφορίας για αρχεία/scans (MAX 20 for both)
	-struct stack_node: απλή δομή στοίβας που χρησιμεύει στις προσπελάσεις εντός του δέντρου (διατήρηση μονοπατιού κλπ)
	-int push(..)/int pop(..)/void delete_stack(..): απλές συναρτήσεις διαχείρισης στοίβας
	
	-int create_block(..): δημιουργεί ένα index block ή ένα data block ανάλογα με την τιμή broot(0 for index/1 for data) και προσθέτει επιπλέον πληροφορίες όπως αριστερό/δεξί μπλοκ
			       και πόσες εγγραφές διαθέτει αυτή τη στιγμή το δημιουργημένο block.
	
	-void compute_max_entries(..): συνάρτηση υπολογισμού του μέγιστου αριθμού keys-pointer που χωράει κάθε index block ή των keys-data που χωράει κάθε data block.

	-int key_compare(..): συνάρτηση σύγκρισης για 2 κλειδιά. (key1 > key2 -> int>0, key1 <key 2 -> int<0, key1=key2 -> int=0)
	
	-int find_block(..): συνάρτηση αναζήτησης στα block βάσει κλειδιού. Αποθηκεύει το μονοπάτι από index blocks που ακολούθησεε για να βρει το block στην στοίβα.

	-void sort_block(..): συνάρτηση ταξινόμησης index blocks ή data blocks. Για index blocks δέχεται τα δεδομένα ενός block και ένα κλειδί. Για data blocks δέχεται ένα
			      ζεύγος key-value. 

	-int calculate_same_keys(..): συνάρτηση υπολογισμού του πλήθους ίσων κλειδιών σε ένα σημείο που θα γίνει split. Χρησιμοποιείται για να διασφαλίσει πως όλα τα όμοια
				      κλειδιά παραμένουν στο ίδιο block.

	-int break_block(..): συνάρτηση split ένος block σε 2 νέα. Οι εγγραφές μοιράζονται σύμφωνα με την θεωρία: στο δεξί αποθηκεύεται η τιμή του κλείδιου που πάει στο index block.

	-int first dblock(..): συνάρτηση εύρεσης του αριστερότερου (πρώτου) data block. (προσπέλαση σε όλα τα αριστερά παιδιά index blocks)

	-int os_compare(..): συνάρτηση σύγκρισης operators σύμφωνα με τα defined.
	
	-void print_red/black_block(..): συναρτήσεις εκτύπωσης των δεδομένων ενός block (red = data block, black = index block). Χρησιμοποιήθηκαν για εύρεση κάποιων σφαλμάτων.


Το αρχείο AM.h/.c περιέχει:
	-δηλώσεις για διάφορα AME_... errors. Χρησιμοποιούνται σε συνάρτηση printerror().
	
	-void AM_Init(): συνάρτηση αρχικοποίησης. Αρχικοποιείται το επίπεδο BF και δύο πίνακες από structs για ανοιχτά αρχεία και scans.

	-int AM_CreateIndex(..): συνάρτηση δημιουργίας του αρχείου. Γίνεται έλεγχος αν το αρχείο υπάρχει ήδη και μετά δημιουργείται ένα κενό αρχείο. Στο πρώτο του block εγγράφονται οι
			   πληροφορίες που χρειάζονται για την λειτουργία του: ένας κωδικός (2426) αναγνώρισης Τύπου αρχείου, και τα ελεγμένα ζευγάρια type-size για τα keys/data
			   καθώς κι ένας αριθμός που υποδεικνύει ότι δεν υπάρχει B+ ρίζα (-1).

	-int AM_DestroyIndex(..): συνάρτηση καταστροφής ενός αρχείου, με έλεγχο αν είναι ανοικτό στους πίνακες open_scans/open_files.

	-int AM_OpenIndex(..): συνάρτηση ανοίγματος του αρχείου. Γίνεται έλεγχος αν το αρχείο υπάρχει κι αν επιτρέπεται να ανοίξει (<MAX_OPEN_FILES) και τοποθετεί τις πληροφορίες του στον
			   πίνακα open_files. Επιστρέφει την θέση του εν λόγω πίνακα που περιλαμβάνει τις πληροφορίες του αρχείου, ή error.

	-int AM_CloseIndex(..): συνάρτηση που κλείνει το αρχείο αφού ελέγξει πως βρίσκεται στον πίνακα open_files και όχι στον open_scans.

	-int AM_InsertEntry(..): στην συνάρτηση αυτή χρησιμοποιείται η πλειοψηφία των συναρτήσεων του funcs.c. Εισάγει το ζεύγος value1-value2 ως key-value στο αρχείο ως εξής:
				-- Αν το αρχείο δεν έχει εγγραφές, δημιουργείται μόνο ένα block δεδομένων και εισάγεται κανονικά το ζεύγος.
				-- Αν το αρχείο έχει εγγραφές αλλά όχι ρίζα, τότε το ζεύγος τοποθετείεται στο block 1. Αν το block 1 είναι γεμάτο, τότε σπάει σε 2 και δημιουργείται ρίζα.
				-- Αν το αρχείο έχει εγγραφές και ρίζα, τότε αναζητείται το block που αντιστοιχεί στην εγγραφή και το ζεύγος τοποθετείεται εκεί. Αν είναι γεμάτο, τότε
				   σπάει σε δύο και οι εγγραφές του μοιράζονται, και το αριστερόετερο κλειδί του "ανεβαίνει" στο father block που δείχνει η στοίβα μονοπατιού. Αν το father
				   block είναι η ρίζα, τότε σπάει κι αυτό και δημιουργείται νέα ρίζα.

	-int AM_OpenIndexScan(..): συνάρτηση που λειτουργεί παρόμια με την OpenIndex. Ενημερώνεται ο πίνακας open_scans αν δεν είναι γεμάτος και ορίζονται τα start block και end block 
				για τις αναζητήσεις από κει και πέρα. Ως key block εννοούμε αυτό όπου το value πρεπει να τοποθετηθεί αν γίνει insert ενώ ο op ελέγχεται για την ορθότητα του.

	-void AM_FindNextEntry(..): συνάρτηση που επιστρέφει όλα τα entries από το ορισμένο από την OpenIndexScan start block μέχρι το end block. Αν φτάσει στο end block, επιστρέφει AM_EOF.
			       Για δική μας διευκόλυνση θεωρούμε ότι όλα τα blocks είναι εσωτερικά ταξινομημένα.

	-int AM_CloseIndexScan(..): συνάρτηση λήξης του scan. Αν το αρχείο βρίσκεται στον πίνακα open_scans, το "κλείνει", αν όχι επιστρέφει error.

	-void AM_PrintError(..): συνάρτηση εκτύπωσης σφαλμάτων ανάλογα με τις δηλωμένες global σταθερές

	-void AM_Close(): συνάρτηση "καθαρισμού" της μνήμης. Κλείνει το επίπεδο BF και διαγράφει τους πίνακες open_files, open_scans.





